{% liquid
  assign heading = section.settings.heading
  assign subheading = section.settings.subheading
  assign columns = section.settings.columns | default: 4
  assign columns_gap = section.settings.columns_gap | default: 16
  assign mobile_card_size = section.settings.mobile_card_size | default: '60cqw'
  assign slider_gutters = ''
  assign first_tab_id = ''

  if section.settings.section_width == 'page-width'
    assign slider_gutters = 'start end'
  endif
%}

<div class="section-background color-{{ section.settings.section_color_scheme }}"></div>

<section
  class="
    section
    section--{{ section.settings.section_width }}
    color-{{ section.settings.section_color_scheme }}
    tab-collection
    section-resource-list
    spacing-style
    gap-style
  "
  style="
    {% render 'spacing-style', settings: section.settings %}
    {% render 'gap-style', value: section.settings.gap %}
  "
  data-section-id="{{ section.id }}"
>
  <div class="tab-collection__inner {% if section.settings.section_width == 'page-width' %}page-width{% endif %}">
    {% if heading or subheading %}
      <div class="tab-collection__header">
        {% if heading %}
          <h2 class="tab-collection__heading">{{ heading }}</h2>
        {% endif %}
        {% if subheading %}
          <div class="tab-collection__subheading rte">{{ subheading }}</div>
        {% endif %}
      </div>
    {% endif %}

    {% if section.blocks.size > 0 %}
      <tabs-component class="product-tabs tab-collection__tabs">
        <native-scrollbar class="tabs__head product-tabs__head">
          <ul class="tabs product-tabs-title" role="tablist" data-scrollbar data-scrollbar-slider>
            {% for block in section.blocks %}
              {% liquid
                assign tab_id = 'TabCollection-' | append: section.id | append: '-' | append: block.id
                assign label = block.settings.title | default: 'Collection'

                if first_tab_id == ''
                  assign first_tab_id = tab_id
                endif
              %}
              <li class="tabs__item" {{ block.shopify_attributes }}>
                <button
                  class="tab-link{% if tab_id == first_tab_id %} current{% endif %}"
                  data-tab="{{ tab_id }}"
                  id="{{ tab_id }}-label"
                  role="tab"
                  aria-selected="{% if tab_id == first_tab_id %}true{% else %}false{% endif %}"
                  aria-controls="{{ tab_id }}-panel"
                  tabindex="{% if tab_id == first_tab_id %}0{% else %}-1{% endif %}"
                  type="button"
                >
                  {{- label -}}
                </button>
              </li>
            {% endfor %}
          </ul>

          <div class="product-tabs__arrows">
            <button
              class="tabs__arrow tabs__arrow--prev"
              type="button"
              aria-label="Previous tab"
              data-tabs-prev
            >
              {{- 'icon-chevron-left.svg' | inline_asset_content -}}
            </button>
            <button
              class="tabs__arrow tabs__arrow--next"
              type="button"
              aria-label="Next tab"
              data-tabs-next
            >
              {{- 'icon-chevron-right.svg' | inline_asset_content -}}
            </button>
          </div>
        </native-scrollbar>

        <div class="tabs__body product-tabs__body tab-collection__panels">
          {% for block in section.blocks %}
            {% liquid
              assign tab_id = 'TabCollection-' | append: section.id | append: '-' | append: block.id
              assign tab_collections = block.settings.collection_list
              assign max_items = block.settings.max_items | default: section.settings.max_items

              if tab_collections == blank
                assign max_items = max_items | default: 4
              else
                if max_items == blank
                  assign max_items = tab_collections.count
                endif
              endif

              if tab_collections == blank
                for i in (1..max_items)
                  assign tab_collections = tab_collections | append: ', '
                endfor
                assign tab_collections = tab_collections | split: ','
              endif
            %}

            {% capture list_items %}
              {% for collection in tab_collections limit: max_items %}
                <div class="resource-list__item">
                  {% capture card_image %}
                    {% render 'resource-image',
                      content_type: 'collections',
                      image_source: blank,
                      parent_block_id: block.id,
                      block_settings: block.settings,
                      section_settings: section.settings,
                      collection: collection
                    %}
                  {% endcapture %}

                  {% capture card_children %}
                    <p class="h5">{{ collection.title | default: 'Collection' }}</p>
                  {% endcapture %}

                  {% render 'collection-card',
                    card_image: card_image,
                    children: card_children,
                    block: block,
                    collection: collection,
                    section: section
                  %}
                </div>
                {% unless forloop.last %}
                  <!--@list/split-->
                {% endunless %}
              {% endfor %}
            {% endcapture %}

            {% assign list_items_array = list_items | strip | split: '<!--@list/split-->' %}

            <div
              class="tab-content{% if tab_id == first_tab_id %} current{% endif %}"
              id="{{ tab_id }}-panel"
              role="tabpanel"
              aria-labelledby="{{ tab_id }}-label"
              data-tab-content="{{ tab_id }}"
              {% unless tab_id == first_tab_id %}hidden{% endunless %}
            >
              {% render 'resource-list',
                list_items: list_items,
                list_items_array: list_items_array,
                settings: section.settings,
                carousel_ref: 'TabCollectionCarousel-' | append: section.id | append: '-' | append: block.id,
                slide_count: max_items,
                content_type: 'collections',
                test_id: 'tab-collection-carousel'
              %}
            </div>
          {% endfor %}
        </div>
      </tabs-component>
    {% else %}
      <div class="tab-collection__empty">
        {{ 'sections.onboarding.no_content' | t | default: 'Add tabs to show collections.' }}
      </div>
    {% endif %}
  </div>
</section>

{% schema %}
{
  "name": "Tab collection",
  "tag": "section",
  "class": "tab-collection-section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Shop collections"
    },
    {
      "type": "richtext",
      "id": "subheading",
      "label": "Text"
    },
    {
      "type": "select",
      "id": "layout_type",
      "label": "Layout type",
      "options": [
        { "value": "carousel", "label": "Carousel" }
      ],
      "default": "carousel"
    },
    {
      "type": "range",
      "id": "columns",
      "label": "Columns",
      "min": 1,
      "max": 8,
      "step": 1,
      "default": 4
    },
    {
      "type": "select",
      "id": "mobile_card_size",
      "label": "Mobile card size",
      "options": [
        { "value": "60cqw", "label": "1 per row" },
        { "value": "44cqw", "label": "2 per row" }
      ],
      "default": "60cqw"
    },
    {
      "type": "range",
      "id": "columns_gap",
      "label": "Horizontal gap",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 16
    },
    {
      "type": "header",
      "content": "Carousel navigation"
    },
    {
      "type": "select",
      "id": "icons_style",
      "label": "Icon",
      "options": [
        { "value": "arrow", "label": "Arrows" },
        { "value": "chevron", "label": "Chevrons" },
        { "value": "arrows_large", "label": "Arrows large" },
        { "value": "chevron_large", "label": "Chevrons large" },
        { "value": "none", "label": "None" }
      ],
      "default": "arrow"
    },
    {
      "type": "select",
      "id": "icons_shape",
      "label": "Icon background",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "circle", "label": "Circle" },
        { "value": "square", "label": "Square" }
      ],
      "default": "none",
      "visible_if": "{{ section.settings.icons_style != 'none' }}"
    },
    {
      "type": "header",
      "content": "Section layout"
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "Section width",
      "options": [
        { "value": "page-width", "label": "Page width" },
        { "value": "full-width", "label": "Full width" }
      ],
      "default": "page-width"
    },
    {
      "type": "range",
      "id": "gap",
      "label": "Section gap",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 12
    },
    {
      "type": "color_scheme",
      "id": "section_color_scheme",
      "label": "Section color scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "Padding top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 32
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "Padding bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 32
    },
    {
      "type": "range",
      "id": "padding-inline-start",
      "label": "Padding left",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-inline-end",
      "label": "Padding right",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 0
    }
  ],
  "blocks": [
    {
      "type": "tab",
      "name": "Tab",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Tab title",
          "default": "Collection"
        },
        {
          "type": "collection_list",
          "id": "collection_list",
          "label": "Collections"
        },
        {
          "type": "range",
          "id": "max_items",
          "label": "Max items",
          "min": 1,
          "max": 16,
          "step": 1,
          "default": 6
        },
        {
          "type": "header",
          "content": "Card layout"
        },
        {
          "type": "select",
          "id": "placement",
          "label": "Content placement",
          "options": [
            { "value": "on_image", "label": "On image" },
            { "value": "below_image", "label": "Below image" }
          ],
          "default": "on_image"
        },
        {
          "type": "select",
          "id": "horizontal_alignment",
          "label": "Content alignment",
          "options": [
            { "value": "flex-start", "label": "Left" },
            { "value": "center", "label": "Center" },
            { "value": "flex-end", "label": "Right" }
          ],
          "default": "flex-start"
        },
        {
          "type": "select",
          "id": "vertical_alignment",
          "label": "Content position",
          "options": [
            { "value": "flex-start", "label": "Top" },
            { "value": "center", "label": "Center" },
            { "value": "flex-end", "label": "Bottom" }
          ],
          "default": "center",
          "visible_if": "{{ block.settings.placement == 'on_image' }}"
        },
        {
          "type": "range",
          "id": "collection_card_gap",
          "label": "Content gap",
          "min": 0,
          "max": 50,
          "step": 1,
          "unit": "px",
          "default": 8
        },
        {
          "type": "header",
          "content": "Appearance"
        },
        {
          "type": "checkbox",
          "id": "inherit_color_scheme",
          "label": "Inherit color scheme",
          "default": true
        },
        {
          "type": "color_scheme",
          "id": "color_scheme",
          "label": "Color scheme",
          "default": "scheme-1",
          "visible_if": "{{ block.settings.inherit_color_scheme == false }}"
        },
        {
          "type": "select",
          "id": "border",
          "label": "Border style",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "solid", "label": "Solid" }
          ],
          "default": "none"
        },
        {
          "type": "range",
          "id": "border_width",
          "min": 0,
          "max": 10,
          "step": 0.5,
          "unit": "px",
          "label": "Border width",
          "default": 1,
          "visible_if": "{{ block.settings.border != 'none' }}"
        },
        {
          "type": "range",
          "id": "border_opacity",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "label": "Border opacity",
          "default": 100,
          "visible_if": "{{ block.settings.border != 'none' }}"
        },
        {
          "type": "range",
          "id": "border_radius",
          "label": "Border radius",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "px",
          "default": 0
        },
        {
          "type": "header",
          "content": "Image"
        },
        {
          "type": "select",
          "id": "image_ratio",
          "label": "Image aspect ratio",
          "info": "Auto uses the collection image ratio.",
          "options": [
            { "value": "adapt", "label": "Auto" },
            { "value": "portrait", "label": "Portrait" },
            { "value": "square", "label": "Square" },
            { "value": "circle", "label": "Circle" },
            { "value": "landscape", "label": "Landscape" }
          ],
          "default": "portrait"
        },
        {
          "type": "checkbox",
          "id": "toggle_overlay",
          "label": "Media overlay",
          "default": false
        },
        {
          "type": "color",
          "id": "overlay_color",
          "label": "Overlay color",
          "alpha": true,
          "default": "#00000026",
          "visible_if": "{{ block.settings.toggle_overlay }}"
        },
        {
          "type": "select",
          "id": "overlay_style",
          "label": "Overlay style",
          "options": [
            { "value": "solid", "label": "Solid" },
            { "value": "gradient", "label": "Gradient" }
          ],
          "default": "solid",
          "visible_if": "{{ block.settings.toggle_overlay }}"
        },
        {
          "type": "select",
          "id": "gradient_direction",
          "label": "Gradient direction",
          "options": [
            { "value": "to top", "label": "Up" },
            { "value": "to bottom", "label": "Down" }
          ],
          "default": "to top",
          "visible_if": "{{ block.settings.toggle_overlay and block.settings.overlay_style == 'gradient' }}"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Tab collection",
      "category": "Collections",
      "blocks": [
        { "type": "tab" },
        { "type": "tab" }
      ]
    }
  ]
}
{% endschema %}

{% stylesheet %}
  .tab-collection__inner {
    width: 100%;
  }

  .tab-collection__header {
    display: grid;
    gap: 8px;
  }

  .tab-collection__heading {
    margin: 0;
  }

  .tab-collection__panels {
    margin-top: 12px;
  }

  .tab-collection__empty {
    text-align: center;
    padding: var(--gap-xl);
    border: 1px dashed rgb(var(--color-border-rgb, 0 0 0) / 0.35);
    border-radius: var(--style-border-radius-cards, 12px);
  }
{% endstylesheet %}
