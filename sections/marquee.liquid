{% capture block_markup %}
  {% content_for 'blocks' %}
{% endcapture %}
{% liquid
  assign text_size = 70
  assign mobile_font_size = text_size | times: 0.6 | round: 0
  assign speed_setting = section.settings.speed | default: 'normal'
  assign desktop_speed = 40
  assign mobile_speed = 25
  case speed_setting
    when 'fast'
      assign desktop_speed = 25
      assign mobile_speed = 15
    when 'slow'
      assign desktop_speed = 60
      assign mobile_speed = 40
  endcase
  assign legacy_direction = section.settings.movement_direction | default: 'left'
  assign direction_setting = section.settings.direction | default: legacy_direction
  case direction_setting
    when 'reverse', 'right'
      assign direction_class = 'right'
    else
      assign direction_class = 'left'
  endcase
  assign letter_spacing = '0.3rem'
  assign desktop_padding = 15
  assign mobile_padding = 20
  assign group_gap = desktop_padding
  assign block_markup_stripped = block_markup | strip
  assign marquee_source = ''
  if block_markup_stripped != blank
    assign marquee_source = block_markup
  endif
  if marquee_source == blank
    assign marquee_source = 't:custom.marquee.default_text'
  endif
  assign repeat_count = 6
%}

<div class="section-background color-{{ section.settings.color_scheme }}"></div>
<div
  class="section spacing-style color-{{ section.settings.color_scheme }}"
  style="{% render 'spacing-style', settings: section.settings %}"
>
    <div
      class="marquee marquee--{{ section.id }}"
      style="
        --marquee-duration-desktop: {{ desktop_speed }}s;
        --marquee-duration-mobile: {{ mobile_speed }}s;
        --marquee-font-size: {{ text_size }}px;
        --marquee-font-size-mobile: {{ mobile_font_size }}px;
        --marquee-item-padding: {{ desktop_padding }}px;
        --marquee-item-padding-mobile: {{ mobile_padding }}px;
        --marquee-letter-spacing: {{ letter_spacing }};
        --marquee-gap: {{ group_gap }}px;
      "
    >
      <div class="marquee__container gradient color-{{ section.settings.color_scheme }}">
        <div class="marquee__text marquee__text--{{ direction_class }}">
          {% for i in (1..repeat_count) %}
            <div class="marquee__group"{% if i > 1 %} aria-hidden="true"{% endif %}>
              <div class="marquee__item">
                {{ marquee_source }}
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
</div>

{% stylesheet %}
  .marquee {
    width: 100%;
  }

  .marquee__container {
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    width: 100%;
    color: inherit;
    background: var(--gradient-background, transparent);
    padding-block: max(0.25em, calc(var(--marquee-font-size, 3rem) * 0.1));
  }

  .marquee__text {
    display: flex;
    align-items: center;
    gap: var(--marquee-gap, 1.5rem);
    font-size: var(--marquee-font-size, 3rem);
    line-height: 1;
    min-width: max-content;
    will-change: transform;
    animation: marquee-left var(--marquee-duration-desktop, 20s) linear infinite;
  }

  .marquee__text--right {
    animation-name: marquee-right;
  }

  .marquee__group {
    display: flex;
    align-items: center;
    white-space: nowrap;
  }

  .marquee__item {
    display: inline-flex;
    align-items: center;
    padding-inline: var(--marquee-item-padding, 1rem);
    letter-spacing: var(--marquee-letter-spacing, 0);
  }

  .marquee__item > * {
    margin: 0;
  }

  .marquee-underline {
    text-decoration: none;
    color: inherit;
    display: block;
  }

  @media (max-width: 749px) {
    .marquee__text {
      font-size: var(--marquee-font-size-mobile, 1.8rem);
      animation-duration: var(--marquee-duration-mobile, 10s);
    }

    .marquee__item {
      padding-inline: var(--marquee-item-padding-mobile, var(--marquee-item-padding, 0.75rem));
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .marquee__text {
      animation: none;
    }
  }

  @keyframes marquee-left {
    0% {
      transform: translate3d(0, 0, 0);
    }

    100% {
      transform: translate3d(-50%, 0, 0);
    }
  }

  @keyframes marquee-right {
    0% {
      transform: translate3d(-50%, 0, 0);
    }

    100% {
      transform: translate3d(0, 0, 0);
    }
  }

  .card__badge--framed.color-accent-2 {
    position: absolute;
    display: inline-block;
    line-height: 1;
    text-align: center;
    font-size: 1.2rem;
    left: 0.5rem;
    top: 0.5rem;
    padding: 0.6rem 1.3rem;
    background: var(--gradient-background);
    color: #000;
  }
{% endstylesheet %}

{% schema %}
{
  "name": "t:sections.marquee.name",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "blocks": [
    {
      "type": "text"
    },
    {
      "type": "icon"
    },
    {
      "type": "logo"
    },
    {
      "type": "_divider"
    }
  ],
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:settings.color_scheme",
      "default": "scheme-1"
    },
    {
      "type": "select",
      "id": "direction",
      "label": "t:sections.marquee.settings.direction.label",
      "default": "left",
      "options": [
        {
          "label": "t:sections.marquee.settings.direction.options.left",
          "value": "left"
        },
        {
          "label": "t:sections.marquee.settings.direction.options.right",
          "value": "right"
        }
      ]
    },
    {
      "type": "select",
      "id": "speed",
      "label": "t:sections.marquee.settings.speed.label",
      "default": "normal",
      "options": [
        {
          "label": "t:sections.marquee.settings.speed.options.fast",
          "value": "fast"
        },
        {
          "label": "t:sections.marquee.settings.speed.options.normal",
          "value": "normal"
        },
        {
          "label": "t:sections.marquee.settings.speed.options.slow",
          "value": "slow"
        }
      ]
    },
    {
      "type": "header",
      "content": "t:content.padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "t:settings.top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "t:settings.bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 24
    }
  ],
  "presets": [
    {
      "name": "t:sections.marquee.presets.default.name",
      "category": "t:categories.text"
    }
  ]
}
{% endschema %}
