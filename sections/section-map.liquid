{%- assign display_map = false -%}
{%- if section.settings.api_key != blank and section.settings.map_address != blank -%}
  {%- assign display_map = true -%}
{%- endif -%}
{%- assign desktop_height = section.settings.desktop_height | default: 'image-height' -%}
{%- assign mobile_height = section.settings.mobile_height | default: 'image-height--mobile' -%}
{%- assign heading_tag = section.settings.heading_tag | default: 'h2' -%}

<div class="section-background color-{{ section.settings.color_scheme }}"></div>
<section
  class="section section--{{ section.settings.section_width }} color-{{ section.settings.color_scheme }} spacing-style map-section"
  style="{% render 'spacing-style', settings: section.settings %}"
>
  <div class="map__columns">
    <div class="map__column map__column--content">
      <div class="map__content">
        {%- if section.settings.heading != blank -%}
          <{{ heading_tag }} class="map__heading">
            {{ section.settings.heading }}
          </{{ heading_tag }}>
        {%- endif -%}

        {%- if section.settings.address_content != blank -%}
          <div class="map__rte rte">
            {{ section.settings.address_content }}
          </div>
        {%- endif -%}

        {%- if section.settings.button_label != blank -%}
          <a
            class="map__button {{ section.settings.button_style }}"
            href="https://maps.google.com?daddr={{ section.settings.map_address | url_encode }}"
            target="_blank"
            rel="noopener"
          >
            {{ section.settings.button_label }}
          </a>
        {%- endif -%}
      </div>
    </div>

    <div class="map__column map__column--map">
      <div class="map__visual {{ desktop_height }} {{ mobile_height }}">
        {%- if section.settings.image != blank -%}
          {{
            section.settings.image
            | image_url: width: 2400
            | image_tag:
              widths: '800, 1200, 1600, 2000, 2400',
              sizes: '(min-width: 990px) 66vw, 100vw',
              loading: 'lazy',
              class: 'map__image'
          }}
        {%- else -%}
          {{ 'hero-apparel-2' | placeholder_svg_tag: 'map__image placeholder-svg placeholder-svg--map' }}
        {%- endif -%}

        {%- if display_map -%}
          <map-component
            class="{{ desktop_height }} {{ mobile_height }}"
            data-zoom="{{ section.settings.zoom }}"
            data-style="{{ section.settings.style }}"
            data-address="{{ section.settings.map_address | escape }}"
            data-latlong-correction="{{ section.settings.enable_latlong }}"
            data-lat="{{ section.settings.lat }}"
            data-long="{{ section.settings.long }}"
            data-api-key="{{ section.settings.api_key }}"
          ></map-component>
          <script src="{{ 'map.js' | asset_url }}" defer></script>
        {%- endif -%}
      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "t:sections.map.name",
  "class": "shopify-section--map",
  "settings": [
    {
      "type": "header",
      "content": "t:sections.map.name"
    },
    {
      "type": "text",
      "id": "api_key",
      "label": "t:sections.map.settings.api_key.label"
    },
    {
      "type": "text",
      "id": "map_address",
      "label": "t:sections.map.settings.map_address.label",
      "info": "t:sections.map.settings.map_address.info",
      "default": "1600 Amphitheatre Parkway, Mountain View, CA"
    },
    {
      "type": "checkbox",
      "id": "enable_latlong",
      "label": "t:sections.map.settings.enable_latlong.label",
      "default": false
    },
    {
      "type": "text",
      "id": "lat",
      "label": "t:sections.map.settings.lat.label",
      "info": "t:sections.map.settings.lat.info"
    },
    {
      "type": "text",
      "id": "long",
      "label": "t:sections.map.settings.long.label",
      "info": "t:sections.map.settings.long.info"
    },
    {
      "type": "range",
      "id": "zoom",
      "label": "t:sections.map.settings.zoom.label",
      "info": "t:sections.map.settings.zoom.info",
      "default": 14,
      "min": 1,
      "max": 20,
      "step": 1
    },
    {
      "type": "select",
      "id": "style",
      "label": "t:sections.map.settings.style.label",
      "default": "basic",
      "options": [
        { "value": "basic", "label": "t:sections.map.settings.style.options.basic" },
        { "value": "light", "label": "t:sections.map.settings.style.options.light" },
        { "value": "white_label", "label": "t:sections.map.settings.style.options.white_label" },
        { "value": "dark_label", "label": "t:sections.map.settings.style.options.dark_label" }
      ]
    },
    {
      "type": "header",
      "content": "t:sections.map.name"
    },
    {
      "type": "inline_richtext",
      "id": "heading",
      "label": "t:sections.map.settings.heading.label",
      "default": "Visit our studio"
    },
    {
      "type": "select",
      "id": "heading_tag",
      "label": "t:sections.map.settings.heading_tag.label",
      "default": "h2",
      "options": [
        { "value": "h1", "label": "t:sections.map.settings.heading_tag.options.h1" },
        { "value": "h2", "label": "t:sections.map.settings.heading_tag.options.h2" },
        { "value": "h3", "label": "t:sections.map.settings.heading_tag.options.h3" },
        { "value": "h4", "label": "t:sections.map.settings.heading_tag.options.h4" }
      ]
    },
    {
      "type": "richtext",
      "id": "address_content",
      "label": "t:sections.map.settings.address_content.label",
      "default": "<p>123 Main Street<br>City, State</p><p>Mon–Fri: 10am–6pm</p>"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "t:sections.map.settings.button_label.label",
      "default": "Get directions"
    },
    {
      "type": "select",
      "id": "button_style",
      "label": "t:sections.map.settings.button_style.label",
      "default": "button",
      "options": [
        { "value": "button", "label": "t:sections.map.settings.button_style.options.button" },
        { "value": "button-secondary", "label": "t:sections.map.settings.button_style.options.button-secondary" },
        { "value": "link", "label": "t:sections.map.settings.button_style.options.link" }
      ]
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "t:sections.map.settings.image.label"
    },
    {
      "type": "header",
      "content": "t:sections.map.settings.section_width.label"
    },
    {
      "type": "select",
      "id": "desktop_height",
      "label": "t:sections.map.settings.desktop_height.label",
      "default": "image-height",
      "options": [
        { "value": "image-height", "label": "t:sections.map.settings.desktop_height.options.image-height" },
        { "value": "screen-height-one-half", "label": "t:sections.map.settings.desktop_height.options.screen-height-one-half" },
        { "value": "screen-height-three-quarters", "label": "t:sections.map.settings.desktop_height.options.screen-height-three-quarters" }
      ]
    },
    {
      "type": "select",
      "id": "mobile_height",
      "label": "t:sections.map.settings.mobile_height.label",
      "default": "image-height--mobile",
      "options": [
        { "value": "image-height--mobile", "label": "t:sections.map.settings.mobile_height.options.image-height--mobile" },
        { "value": "screen-height-one-half--mobile", "label": "t:sections.map.settings.mobile_height.options.screen-height-one-half--mobile" },
        { "value": "screen-height-three-quarters--mobile", "label": "t:sections.map.settings.mobile_height.options.screen-height-three-quarters--mobile" }
      ]
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "t:sections.map.settings.section_width.label",
      "default": "full-width",
      "options": [
        { "value": "page-width", "label": "t:sections.map.settings.section_width.options.page-width" },
        { "value": "full-width", "label": "t:sections.map.settings.section_width.options.full-width" }
      ]
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.map.settings.color_scheme.label",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "t:sections.map.settings.padding-block-start.label"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "t:sections.map.settings.padding-block-start.label",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "t:sections.map.settings.padding-block-end.label",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 24
    }
  ],
  "presets": [
    {
      "name": "t:sections.map.presets.default.name",
      "category": "t:categories.map"
    }
  ]
}
{% endschema %}
