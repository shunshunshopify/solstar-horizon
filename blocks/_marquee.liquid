{% liquid
  assign block_settings = block.settings
  assign text_size = block_settings.text_size | default: 64 | plus: 0
  assign mobile_font_size = text_size | times: 0.6 | round: 0
  assign speed_setting = block_settings.speed | default: 'normal'
  assign desktop_speed = 40
  assign mobile_speed = 25
  case speed_setting
    when 'fast'
      assign desktop_speed = 25
      assign mobile_speed = 15
    when 'slow'
      assign desktop_speed = 60
      assign mobile_speed = 40
  endcase
  assign movement_direction = block_settings.movement_direction | default: 'normal'
  case movement_direction
    when 'reverse', 'right'
      assign direction_class = 'right'
    else
      assign direction_class = 'left'
  endcase
  assign marquee_source = block_settings.text
  assign base_spacing = block_settings.gap_between_elements | default: 15 | plus: 0
  if block_settings.text_spacing == false
    assign base_spacing = 0
  endif
  assign mobile_spacing = base_spacing | times: 1.25 | round: 0
  if mobile_spacing < base_spacing
    assign mobile_spacing = base_spacing
  endif
  assign group_gap = base_spacing
  assign letter_spacing = '0'
  if block_settings.text_spacing
    assign letter_spacing = '0.3rem'
  endif
  assign container_classes = 'marquee__container gradient'
  if block_settings.inherit_color_scheme == false
    assign container_classes = container_classes | append: ' color-' | append: block_settings.color_scheme
  endif
  if block_settings.transparent_background
    assign container_classes = container_classes | append: ' marquee__container--transparent'
  endif
%}

<div
  class="marquee-block spacing-style"
  style="{% render 'spacing-style', settings: block_settings %}"
  {{ block.shopify_attributes }}
>
  {% if block_settings.link != blank %}
    <a class="marquee-underline" href="{{ block_settings.link }}">
  {% endif %}
    <div
      class="marquee marquee--{{ block.id }}"
      style="
        --marquee-duration-desktop: {{ desktop_speed }}s;
        --marquee-duration-mobile: {{ mobile_speed }}s;
        --marquee-font-size: {{ text_size }}px;
        --marquee-font-size-mobile: {{ mobile_font_size }}px;
        --marquee-item-padding: {{ base_spacing }}px;
        --marquee-item-padding-mobile: {{ mobile_spacing }}px;
        --marquee-letter-spacing: {{ letter_spacing }};
        --marquee-gap: {{ group_gap }}px;
      "
    >
      <div class="{{ container_classes }}">
        <div class="marquee__text marquee__text--{{ direction_class }}">
          {% for i in (1..6) %}
            <div class="marquee__group"{% if i > 1 %} aria-hidden="true"{% endif %}>
              <div class="marquee__item">
                {{ marquee_source }}
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  {% if block_settings.link != blank %}
    </a>
  {% endif %}
</div>

{% stylesheet %}
  .marquee {
    width: 100%;
  }

  .marquee__container {
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    width: 100%;
    color: inherit;
    background: var(--gradient-background, transparent);
    padding-block: max(0.25em, calc(var(--marquee-font-size, 2.8rem) * 0.1));
  }

  .marquee__container--transparent {
    background: transparent;
  }

  .marquee__text {
    display: flex;
    align-items: center;
    gap: var(--marquee-gap, 1.5rem);
    font-size: var(--marquee-font-size, 2.8rem);
    line-height: 1;
    min-width: max-content;
    will-change: transform;
    animation: marquee-left var(--marquee-duration-desktop, 20s) linear infinite;
  }

  .marquee__text--right {
    animation-name: marquee-right;
  }

  .marquee__group {
    display: flex;
    align-items: center;
    white-space: nowrap;
  }

  .marquee__item {
    display: inline-flex;
    align-items: center;
    padding-inline: var(--marquee-item-padding, 1rem);
    letter-spacing: var(--marquee-letter-spacing, 0);
    white-space: pre;
  }

  .marquee__item > * {
    margin: 0;
  }

  .marquee-underline {
    text-decoration: none;
    color: inherit;
    display: block;
  }

  @media (max-width: 749px) {
    .marquee__text {
      font-size: var(--marquee-font-size-mobile, 1.8rem);
      animation-duration: var(--marquee-duration-mobile, 10s);
    }

    .marquee__item {
      padding-inline: var(--marquee-item-padding-mobile, var(--marquee-item-padding, 0.75rem));
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .marquee__text {
      animation: none;
    }
  }

  @keyframes marquee-left {
    0% {
      transform: translate3d(0, 0, 0);
    }

    100% {
      transform: translate3d(-50%, 0, 0);
    }
  }

  @keyframes marquee-right {
    0% {
      transform: translate3d(-50%, 0, 0);
    }

    100% {
      transform: translate3d(0, 0, 0);
    }
  }

  .card__badge--framed.color-accent-2 {
    position: absolute;
    display: inline-block;
    line-height: 1;
    text-align: center;
    font-size: 1.2rem;
    left: 0.5rem;
    top: 0.5rem;
    padding: 0.6rem 1.3rem;
    background: var(--gradient-background);
    color: #000;
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Scrolling marquee",
  "tag": null,
  "settings": [
    {
      "type": "text",
      "id": "text",
      "label": "Text",
      "default": "Free shipping and returns"
    },
    {
      "type": "url",
      "id": "link",
      "label": "Link"
    },
    {
      "type": "range",
      "id": "text_size",
      "label": "Text size",
      "default": 64,
      "min": 20,
      "max": 150,
      "step": 2,
      "unit": "px"
    },
    {
      "type": "checkbox",
      "id": "text_spacing",
      "label": "Add spacing",
      "default": true
    },
    {
      "type": "select",
      "id": "movement_direction",
      "label": "Direction",
      "options": [
        {
          "value": "normal",
          "label": "Left"
        },
        {
          "value": "reverse",
          "label": "Right"
        }
      ],
      "default": "normal"
    },
    {
      "type": "select",
      "id": "speed",
      "label": "Speed",
      "default": "normal",
      "options": [
        {
          "label": "Fast",
          "value": "fast"
        },
        {
          "label": "Normal",
          "value": "normal"
        },
        {
          "label": "Slow",
          "value": "slow"
        }
      ]
    },
    {
      "type": "checkbox",
      "id": "inherit_color_scheme",
      "label": "Inherit color scheme",
      "default": true
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1",
      "visible_if": "{{ block.settings.inherit_color_scheme == false }}"
    },
    {
      "type": "checkbox",
      "id": "transparent_background",
      "label": "Transparent background",
      "default": true
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "Top padding",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "Bottom padding",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "gap_between_elements",
      "label": "Spacing between repeats",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 15
    }
  ],
  "presets": [
    {
      "name": "Scrolling marquee",
      "category": "t:categories.decorative"
    }
  ]
}
{% endschema %}
