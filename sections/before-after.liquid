{%- liquid
  assign before_image = section.settings.before_image
  assign after_image = section.settings.after_image
  assign before_label = section.settings.before_label | default: 'Before'
  assign after_label = section.settings.after_label | default: 'After'

  assign has_content = false

  capture content_blocks
    for block in section.blocks
      case block.type
        when 'heading'
          if block.settings.heading != blank
            assign has_content = true
            assign heading_tag = block.settings.heading_tag | default: 'h2'
            echo '<div class="before-after__block" ' | append: block.shopify_attributes | append: '>'
            echo '<' | append: heading_tag | append: ' class="before-after__heading">'
            echo block.settings.heading
            echo '</' | append: heading_tag | append: '>'
            echo '</div>'
          endif
        when 'subheading'
          if block.settings.subheading != blank
            assign has_content = true
            echo '<div class="before-after__block before-after__subheading" ' | append: block.shopify_attributes | append: '>'
            echo block.settings.subheading | escape
            echo '</div>'
          endif
        when 'text'
          if block.settings.text != blank
            assign has_content = true
            echo '<div class="before-after__block rte" ' | append: block.shopify_attributes | append: '>'
            echo block.settings.text
            echo '</div>'
          endif
      endcase
    endfor
  endcapture

  capture action_blocks
    for block in section.blocks
      if block.type == 'button' and block.settings.button_label != blank
        assign has_content = true
        echo '<div class="before-after__action" ' | append: block.shopify_attributes | append: '>'
        echo '<a '
        if block.settings.button_link != blank
          echo 'href="' | append: block.settings.button_link | append: '"'
        else
          echo 'role="link" aria-disabled="true"'
        endif
        if block.settings.open_in_new_tab
          echo ' target="_blank" rel="noopener noreferrer"'
        endif
        echo ' class="' | append: block.settings.button_style | append: '">'
        echo block.settings.button_label
        echo '</a></div>'
      endif
    endfor
  endcapture

  assign has_content_area = has_content
-%}

<div class="section-background color-{{ section.settings.color_scheme }}"></div>
<section
  class="
    section
    section--{{ section.settings.section_width }}
    before-after
    color-{{ section.settings.color_scheme }}
    spacing-style
    gap-style
    {% if has_content_area %}before-after--with-content{% else %}before-after--media-only{% endif %}
  "
  style="
    {% render 'spacing-style', settings: section.settings %}
    {% render 'gap-style', value: section.settings.gap %}
  "
  data-section-id="{{ section.id }}"
>
  <div class="before-after__inner">
    {%- if has_content_area -%}
      <div class="before-after__content text-{{ section.settings.text_alignment }}">
        {{ content_blocks }}

        {%- if action_blocks != blank -%}
          <div class="before-after__actions before-after__actions--desktop">
            {{ action_blocks }}
          </div>
        {%- endif -%}
      </div>
    {%- endif -%}

    <div class="before-after__media">
      {% render 'compare-images',
        before_image: before_image,
        after_image: after_image,
        before_label: before_label,
        after_label: after_label
      %}

      {%- if action_blocks != blank -%}
        <div class="before-after__actions before-after__actions--mobile">
          {{ action_blocks }}
        </div>
      {%- endif -%}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Before and after",
  "tag": "section",
  "class": "section-wrapper",
  "settings": [
    {
      "type": "image_picker",
      "id": "before_image",
      "label": "Before image"
    },
    {
      "type": "image_picker",
      "id": "after_image",
      "label": "After image"
    },
    {
      "type": "text",
      "id": "before_label",
      "label": "Before label",
      "default": "Before"
    },
    {
      "type": "text",
      "id": "after_label",
      "label": "After label",
      "default": "After"
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "Section width",
      "options": [
        {
          "value": "page-width",
          "label": "Page"
        },
        {
          "value": "full-width",
          "label": "Full"
        }
      ],
      "default": "page-width"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "left"
    },
    {
      "type": "range",
      "id": "gap",
      "label": "Block spacing",
      "min": 0,
      "max": 80,
      "step": 4,
      "unit": "px",
      "default": 32
    },
    {
      "type": "header",
      "content": "Padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "Top",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "default": 48
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "Bottom",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "default": 48
    }
  ],
  "blocks": [
    {
      "type": "subheading",
      "name": "Subheading",
      "settings": [
        {
          "type": "text",
          "id": "subheading",
          "label": "Subheading",
          "default": "Results you can see"
        }
      ]
    },
    {
      "type": "heading",
      "name": "Heading",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Before and after"
        },
        {
          "type": "select",
          "id": "heading_tag",
          "label": "Heading tag",
          "default": "h2",
          "options": [
            {
              "value": "h1",
              "label": "H1"
            },
            {
              "value": "h2",
              "label": "H2"
            },
            {
              "value": "h3",
              "label": "H3"
            },
            {
              "value": "h4",
              "label": "H4"
            },
            {
              "value": "h5",
              "label": "H5"
            },
            {
              "value": "h6",
              "label": "H6"
            }
          ]
        }
      ]
    },
    {
      "type": "text",
      "name": "Text",
      "settings": [
        {
          "type": "richtext",
          "id": "text",
          "label": "Text",
          "default": "<p>Show off how your product, treatment, or service transforms before and after.</p>"
        }
      ]
    },
    {
      "type": "button",
      "name": "Button",
      "settings": [
        {
          "type": "text",
          "id": "button_label",
          "label": "Text",
          "default": "Shop now"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Link"
        },
        {
          "type": "checkbox",
          "id": "open_in_new_tab",
          "label": "Open link in new tab",
          "default": false
        },
        {
          "type": "select",
          "id": "button_style",
          "label": "Style",
          "default": "button",
          "options": [
            {
              "value": "button",
              "label": "Primary"
            },
            {
              "value": "button-secondary",
              "label": "Secondary"
            },
            {
              "value": "link",
              "label": "Text"
            }
          ]
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Before and after",
      "category": "Media",
      "blocks": [
        {
          "type": "heading"
        },
        {
          "type": "text"
        },
        {
          "type": "button"
        }
      ]
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  }
}
{% endschema %}
